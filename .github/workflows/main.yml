name: DevOps Actions

on:
  push:

jobs:
  job0:
    name: Job0
    runs-on: self-hosted

    steps:
      # 1. Checkout code
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Remove old images
        run: |
          # $ErrorActionPreference = "SilentlyContinue"
          
          # $images = @(
            "deveshmodi662/dorobe-app:${{github.ref_name}}"
            # "deveshmodi662/exportservice-app:${{github.ref_name}}", 
            # "deveshmodi662/collabservice-app:${{github.ref_name}}", 
            # "deveshmodi662/exportservice-app:${{github.ref_name}}", 
            # "deveshmodi662/gatewayservice-app:${{github.ref_name}}", 
            # "deveshmodi662/serviceregistry-app:${{github.ref_name}}", 
            # "deveshmodi662/doroui-app:${{github.ref_name}}"
          )

          # foreach ($img in $images) {
          #   docker image inspect $img *>$null
          #   if($LASTEXITCODE -eq 0) {
          #     docker rmi $img
          #   }
          # }

          echo "Skipped delete"

        
      # 7. (Optional) Print build artifacts
      - name: Ping
        run: |
          echo "Branch : ${{github.ref_name}}"
          cd dorobe
          # docker rmi `
          #   deveshmodi662/${{github.ref_name}}-dorobe-app:v1 `
          #   deveshmodi662/${{github.ref_name}}-exportservice-app:v1 `
          #   deveshmodi662/${{github.ref_name}}-collabservice-app:v1 `
          #   deveshmodi662/${{github.ref_name}}-exportservice-app:v1 `
          #   deveshmodi662/${{github.ref_name}}-gatewayservice-app:v1 `
          #   deveshmodi662/${{github.ref_name}}-serviceregistry-app:v1 `
          #   deveshmodi662/${{github.ref_name}}-doroui-app:v1 `
          #   || true
          docker build -t deveshmodi662/dorobe-app:${{github.ref_name}} .
          cd ..
          cd exportservice
          docker build -t deveshmodi662/exportservice-app:${{github.ref_name}} .
          cd ..
          cd collabservice
          docker build -t deveshmodi662/collabservice-app:${{github.ref_name}} .
          cd ..
          cd gatewayservice
          docker build -t deveshmodi662/gatewayservice-app:${{github.ref_name}} .
          cd ..
          cd serviceregistry
          docker build -t deveshmodi662/serviceregistry-app:${{github.ref_name}} .
          cd ..
          cd doroui
          docker build -t deveshmodi662/doroui-app:${{github.ref_name}} .
          cd ..
          
